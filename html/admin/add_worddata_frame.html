<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport"
        content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>添加词汇Frame</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <style>
        .row {
            box-sizing: border-box;
            width: auto;
            height: 70px;
            margin-left: 32px;
            margin-right: 32px;
            padding-top: 40px;
            border-bottom: 1px solid #888;
        }

        .input {
            width: 100%;
            height: 20px;
            line-height: 20px;
            border: none;
            outline: none;
            font-size: 16px;
        }

        .btn {
            width: auto;
            height: 50px;
            margin-left: 32px;
            margin-right: 32px;
            margin-top: 32px;
            background-color: #ff7f27dc;
            color: #fff;
            font-size: 24px;
            line-height: 50px;
            text-align: center;
            border-radius: 8px;
        }

        #send-btn {
            width: 100px;
            height: 30px;
            float: right;
            background-color: #ff7f27dc;
            font-size: 18px;
            color: #fff;
            text-align: center;
            border-radius: 8px;
        }

        .highlight {
            opacity: 0.7;
        }

        .file {
            box-sizing: border-box;
            width: auto;
            height: 70px;
            margin-left: 32px;
            margin-right: 32px;
            padding-top: 40px;
        }
    </style>
</head>

<body>
    <!-- 输入框 -->
    <div class="row">
        <input id="soundmark" class="input" type="text" >
    </div>
    <div class="row">
        <input id="chinese" class="input" type="text" >
    </div>
    <div class="row">
        <input id="sentsoud" class="input" type="text" >
    </div>
    <div class="row">
        <input id="sentrans" class="input" type="text" >
    </div>
    <div class='file'>
        上传图片：
        <input id="uploadInput" type="file" name="file" />
    </div>
    <div class='file'>
        上传音频：
        <input id="uploadInput" type="file" name="file" />
    </div>

    <div class="btn" tapmode="highlight" onclick="addwordinfo();">添加词汇信息</div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript">

    apiready = function () {
        fnInitUIInput();
    };

    var UIInput;
    var soundmarkUIInputId;
    var sentsoudUIInputId;
    var chineseUIInputId;
    var sentransUIInputId;
    var soundmarkValue;
    var sentsoudValue;
    var chineseValue;
    var sentransValue;



    function fnInitUIInput() {
        // 粤语音标输入框模块
        var soundmark = $api.byId('soundmark');
        var soundmarkRect = $api.offset(soundmark);
        UIInput = api.require('UIInput');
        UIInput.open({
            rect: {
                x: soundmarkRect.l,
                y: soundmarkRect.t,
                w: soundmarkRect.w,
                h: soundmarkRect.h
            },
            styles: {
                bgColor: '#fff',
                size: 16,
                color: '#000',
                placeholder: {
                    color: '#ccc'
                }
            },
            autoFocus: false,
            maxRows: 1,
            placeholder: '粤语音标',
            keyboardType: 'default',
            fixedOn: api.frameName
        }, function (ret, err) {
            if (ret) {
                soundmarkUIInputId = ret.id;
                if (ret && ret.eventType == "show") {
                    setTimeout(function () {
                        UIInput.popupKeyboard({
                            id: soundmarkUIInputId
                        });
                    }, 200);
                } else if (ret.eventType == "change") {
                    UIInput.value({
                        id: soundmarkUIInputId
                    }, function (ret, err) {
                        if (ret) {
                            if (ret.status) {
                                soundmarkValue = ret.msg;
                            }
                        }
                    });
                }
            }
        });

        // 例句音标输入模块
        var sentsoud = $api.byId('sentsoud');
        var sentsoudRect = $api.offset(sentsoud);
        UIInput.open({
            rect: {
                x: sentsoudRect.l,
                y: sentsoudRect.t,
                w: sentsoudRect.w,
                h: sentsoudRect.h
            },
            styles: {
                bgColor: '#fff',
                size: 16,
                color: '#000',
                placeholder: {
                    color: '#ccc'
                }
            },
            autoFocus: false,
            maxRows: 1,
            placeholder: '例句音标',
            keyboardType: 'default',
            inputType: 'text',
            fixedOn: api.frameName
        }, function (ret, err) {
            if (ret) {
                sentsoudUIInputId = ret.id;
                if (ret.eventType == "change") {
                    UIInput.value({
                        id: sentsoudUIInputId
                    }, function (ret, err) {
                        if (ret) {
                            if (ret.status) {
                                sentsoudValue = ret.msg;
                            }
                        }
                    });
                }
            }
        });

        //汉语输入框模块
        var chinese = $api.byId('chinese');
        var chineseRect = $api.offset(chinese);
        UIInput.open({
            rect: {
                x: chineseRect.l,
                y: chineseRect.t,
                w: chineseRect.w,
                h: chineseRect.h
            },
            styles: {
                bgColor: '#fff',
                size: 16,
                color: '#000',
                placeholder: {
                    color: '#ccc'
                }
            },
            autoFocus: false,
            maxRows: 1,
            placeholder: '汉语',
            keyboardType: 'default',
            inputType: 'text',
            fixedOn: api.frameName
        }, function (ret, err) {
            if (ret) {
                chineseUIInputId = ret.id;
                if (ret.eventType == "change") {
                    UIInput.value({
                        id: chineseUIInputId
                    }, function (ret, err) {
                        if (ret) {
                            if (ret.status) {
                                chineseValue = ret.msg;
                            }
                        }
                    });
                }
            }
        });
        // 例句翻译输入框模块
        var sentrans = $api.byId('sentrans');
        var sentransRect = $api.offset(sentrans);
        UIInput.open({
            rect: {
                x: sentransRect.l,
                y: sentransRect.t,
                w: sentransRect.w,
                h: sentransRect.h
            },
            styles: {
                bgColor: '#fff',
                size: 16,
                color: '#000',
                placeholder: {
                    color: '#ccc'
                }
            },
            autoFocus: false,
            maxRows: 1,
            placeholder: '例句翻译',
            keyboardType: 'default',
            fixedOn: api.frameName
        }, function (ret, err) {
            if (ret) {
                sentransUIInputId = ret.id;
                if (ret && ret.eventType == "show") {
                    setTimeout(function () {
                        UIInput.popupKeyboard({
                            id: sentransUIInputId
                        });
                    }, 200);
                } else if (ret.eventType == "change") {
                    UIInput.value({
                        id: sentransUIInputId
                    }, function (ret, err) {
                        if (ret) {
                            if (ret.status) {
                                sentransValue = ret.msg;
                            }
                        }
                    });
                }
            }
        });
    }

    // 写入信息
    function addwordinfo() {
        if (!soundmarkValue) {
            if (api.systemType == 'android') {
                setTimeout(function () {
                    UIInput.popupKeyboard({
                        id: soundmarkUIInputId
                    });
                }, 200);
            } else {
                UIInput.popupKeyboard({
                    id: soundmarkUIInputId
                });
            }
            return;
        }
        if (!chineseValue) {
            if (api.systemType == 'android') {
                setTimeout(function () {
                    UIInput.popupKeyboard({
                        id: chineseUIInputId
                    });
                }, 200);
            } else {
                UIInput.popupKeyboard({
                    id: chineseUIInputId
                });
            }
            return;
        }
        if (!sentsoudValue) {
            if (api.systemType == 'android') {
                setTimeout(function () {
                    UIInput.popupKeyboard({
                        id: sentsoudUIInputId
                    });
                }, 200);
            } else {
                UIInput.popupKeyboard({
                    id: sentsoudUIInputId
                });
            }
            return;
        }
        if (!sentransValue) {
            if (api.systemType == 'android') {
                setTimeout(function () {
                    UIInput.popupKeyboard({
                        id: sentransUIInputId
                    });
                }, 200);
            } else {
                UIInput.popupKeyboard({
                    id: sentransUIInputId
                });
            }
            return;
        }
        function handleChangeFile() {
            var files = $api.byId('uploadInput').files;
            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                //上传
                uploadFile(file);
            }
            $api.byId('uploadInput').value = [];
        }

        function uploadFile(file) {
            var xhr = new XMLHttpRequest();
            var url = '上传文件的接口地址';
            xhr.open('POST', url, true);
            var formData = new FormData();
            formData.append('file', file);
            formData.append('fname', file.name);
            api.showProgress({ title: '正在上传' });
            xhr.send(formData);
            xhr.onreadystatechange = function () {
                api.hideProgress();
                if (xhr.readyState === 4) {
                    var resData = JSON.parse(xhr.response);
                    if (resData && (resData.id || resData.bizkey)) {
                        openToast('文件上传成功');
                        //执行刷新页面的方法 initView();
                    } else {
                        api.hideProgress();
                        openToast('文件上传失败');
                    }
                }
            };
        }
        // 接口
        api.ajax({
            url: 'http://120.77.205.20:9090/email.php',
            method: 'post',
            dataType: "json",
            data: {
                values: {
                    "email": emailValue,
                }
            }
        }, function (ret, err) {
            if (ret) {
                api.alert({
                    title: '提示',
                    msg: '添加成功',
                }, function (ret, err) {
                    if (ret) {
                        api.closeWin();
                    }
                });
            } else {
                api.toast({
                    msg: '添加失败',
                    duration: 2000,
                    location: 'middle'
                });
            }
        });
    }



</script>

</html>